<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Demo Live Chart</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="stylesheet" href="../assets/css/style.css" />
<meta name="description" content="Simple streaming line chart example for embedding." />
<style>
  body { padding: 1.2rem 0 2.5rem; }
  canvas { background: #10161d; border: 1px solid #22303d; border-radius: 10px; }
</style>
</head>
<body>
<header>
  <h1>Streaming Chart</h1>
  <p>A lightweight example using Chart.js CDN. Adjust update rate and noise to demonstrate dynamic data feeds.</p>
</header>

<main class="panel">
  <div class="flex flex-col-mobile">
    <label class="inline-label">Update Interval (ms)
      <input id="interval" type="range" min="100" max="2000" value="600" step="50" />
      <code id="intervalLabel">600</code>
    </label>
    <label class="inline-label">Noise Amplitude
      <input id="noise" type="range" min="0" max="1" value=".3" step=".01" />
      <code id="noiseLabel">0.30</code>
    </label>
    <button class="btn" id="pauseBtn">Pause</button>
  </div>
  <canvas id="chart" width="900" height="350" aria-label="Live data chart"></canvas>
  <p class="notice">Embed with: <code>&lt;iframe src=".../demo-chart.html" width="620" height="430"&gt;&lt;/iframe&gt;</code></p>
</main>

<footer>
  <small>Â© 2025 rayus86</small>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"
  integrity="sha256-LqCNbGLYKs/IRw+pALCB4r5RPbR+QpFbl2CAiNDRApM=" crossorigin="anonymous"></script>
<script>
(function() {
  const ctx = document.getElementById('chart').getContext('2d');
  let t = 0;
  let running = true;
  const points = [];
  for (let i=0;i<40;i++) points.push({x: t+i, y: 0});
  const chart = new Chart(ctx, {
    type: 'line',
    data: {
      datasets: [{
        label: 'Signal',
        data: points,
        tension: .25,
        borderColor: '#4aa3ff',
        borderWidth: 2,
        pointRadius: 0,
        fill: false
      }]
    },
    options: {
      animation: false,
      responsive: true,
      scales: {
        x: { type: 'linear', display: true, grid: { color: 'rgba(255,255,255,.05)' } },
        y: { display: true, grid: { color: 'rgba(255,255,255,.08)' } }
      },
      plugins: {
        legend: { labels: { color: '#d9e4ec' } }
      }
    }
  });

  const noiseEl = document.getElementById('noise');
  const noiseLabel = document.getElementById('noiseLabel');
  const intervalEl = document.getElementById('interval');
  const intervalLabel = document.getElementById('intervalLabel');
  const pauseBtn = document.getElementById('pauseBtn');
  let timer;

  function randn() {
    let u=0,v=0; while(u===0)u=Math.random(); while(v===0)v=Math.random();
    return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v);
  }

  function step() {
    if (!running) return;
    const amp = parseFloat(noiseEl.value);
    const next = Math.sin(t/8) * 2 + randn()*amp;
    points.push({x: t, y: next});
    if (points.length > 120) points.shift();
    chart.update();
    t++;
  }

  function schedule() {
    clearInterval(timer);
    timer = setInterval(step, parseInt(intervalEl.value,10));
  }

  noiseEl.addEventListener('input', ()=>{
    noiseLabel.textContent = (+noiseEl.value).toFixed(2);
  });
  intervalEl.addEventListener('input', ()=>{
    intervalLabel.textContent = intervalEl.value;
    schedule();
  });
  pauseBtn.addEventListener('click', ()=>{
    running = !running;
    pauseBtn.textContent = running ? 'Pause' : 'Resume';
  });

  noiseLabel.textContent = (+noiseEl.value).toFixed(2);
  intervalLabel.textContent = intervalEl.value;
  schedule();
})();
</script>
</body>
</html>
